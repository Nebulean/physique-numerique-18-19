% debut d'un fichier latex standard
\documentclass[a4paper,12pt,twoside]{article}

\usepackage{lipsum}
\usepackage{empheq}

% pour l'inclusion de figures en eps,pdf,jpg
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{wrapfig}
% quelques symboles mathematiques en plus
\usepackage{amsmath}
\usepackage{amsthm} % Pour les preuves
% le tout en langue francaise
%\usepackage[french]{babel}
% on peut ecrire directement les caracteres avec l'accent
% a utiliser sur Linux/Windows
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
% a utiliser sur le Mac
%\usepackage[applemac]{inputenc}
% pour l'inclusion de links dans le document
\usepackage[colorlinks,bookmarks=false,linkcolor=blue,urlcolor=blue]{hyperref}
\usepackage{siunitx}
% pour les degrés
\usepackage{textcomp}
\paperheight=297mm
\paperwidth=210mm

\setlength{\textheight}{235mm}
\setlength{\topmargin}{-1.2cm} % pour centrer la page verticalement
%\setlength{\footskip}{5mm}
\setlength{\textwidth}{15cm}
\setlength{\oddsidemargin}{0.56cm}
\setlength{\evensidemargin}{0.56cm}

\pagestyle{plain}

% quelques abreviations utiles
\def \be {\begin{equation}}
\def \ee {\end{equation}}
\def \dd  {{\rm d}}

\newcommand{\mail}[1]{{\href{mailto:#1}{#1}}}
\newcommand{\ftplink}[1]{{\href{ftp://#1}{#1}}}

\newcommand{\illabel}[1]{ ~ \refstepcounter{equation}(\theequation)\label{#1}} % Ecrit une équation dans le texte, numérotés.
\newcommand{\mbf}[1]{\mathbf{#1}} % bold font in math
\newcommand{\grad}[1]{\nabla#1}
\newcommand{\Div}[1]{\nabla\cdot\mathbf{#1}}
\newcommand{\rot}[1]{\nable\cross\mathbf{#1}}
\newcommand{\bracket}[1]{\left(#1\right)}
\newcommand{\sqbracket}[1]{\left[#1\right]}
\newcommand{\lapl}[1]{\Delta#1}

%
% latex SqueletteRapport.tex      % compile la source LaTeX
% xdvi SqueletteRapport.dvi &     % visualise le resultat
% dvips -t a4 -o SqueletteRapport.ps SqueletteRapport % produit un PostScript
% ps2pdf SqueletteRapport.ps      % convertit en pdf

% pdflatex SqueletteRapport.pdf    % compile et produit un pdf
% \message{================> TAILLE DE LA POLICE EN CM \printinunitsof{cm}\prntlen{\textwidth}}

% ======= Le document commence ici ======

\begin{document}
% Le titre, l'auteur et la date
\title{Electrostatics\\{\small Physique Numérique I}\\{\small Rapport 6}}
\date{\today}
\author{Delphine Martres et Damien Korber\\{\small \mail{delphine.martres@epfl.ch} et \mail{damien.korber@epfl.ch}}}

\maketitle
\tableofcontents % Table des matieres


% Quelques options pour les espacements entre lignes, l'identation
% des nouveaux paragraphes, et l'espacement entre paragraphes
\baselineskip=16pt
\parindent=15pt
\parskip=5pt
\newpage

%%%% ON COMMENCE A ECRIRE D'ICI

% \section{Introduction} %TODO: Faire une introduction

\section{Differential equation and variational form}
  \subsection{Differential equation for the potential $\phi(\vec{x})$} \label{sec:equa-diff-phi}
    This section will derive the equation that describes the problem.

    \begin{align*}
      \intertext{First, one of Maxwell's equation is used}
      \nabla\cdot\mathbf{D} &= \rho\bracket{\mathbf{x}} \\
      \intertext{where $\mathbf{D}=\epsilon_0\epsilon_r\mathbf{E}$ is the electric displacement field.}
      \nabla\cdot\bracket{\epsilon_0\epsilon_r\mathbf{E}} &= \rho\bracket{\mathbf{x}} \\
      \nabla\cdot\bracket{\epsilon_r\mathbf{E}} &= \frac{\rho\bracket{\mathbf{x}}}{\epsilon_0} \\
      \epsilon_r\Div{E} + \mathbf{E}\cdot\nabla\epsilon_r &= \frac{\rho\bracket{\mbf{x}}}{\epsilon_0} \\
      \intertext{We know that $\mbf{E}$ derive from a potential $\phi$ such that $\mathbf{E}=-\grad{\phi}$. Thus}
      -\epsilon_r\lapl{\phi}-\grad{\phi}\grad{\epsilon_r} &= \frac{\rho\bracket{\mbf{x}}}{\epsilon_0}
      \intertext{This leads to equation \eqref{eq:equa-diff}.}
    \end{align*}
    \begin{equation}
      \centering
      \boxed{\grad{\phi}\grad{\epsilon_r} + \epsilon_r\lapl{\phi} = -\frac{\rho\bracket{\mbf{x}}}{\epsilon_0}}
      \label{eq:equa-diff}
    \end{equation}

  \subsection{Variational form}
    To numerically solve equation \eqref{eq:equa-diff}, the variational form of the problem must be found.

    \begin{align*}
      \intertext{Let $\eta\bracket{\mbf{x}}\subset\mathcal{C}^1\bracket{\Omega}$, $\eta\bracket{\mbf{x}}=0~ \forall \mbf{x}\in\partial\Omega$. Multiply both sides of equation \eqref{eq:equa-diff} by $\eta\bracket{\mbf{x}}$, and integrate over the volume $\Omega$.}
      \int_\Omega \eta\bracket{\mbf{x}}\grad{\phi}\grad{\epsilon_r}d\mbf{x} + \int_\Omega \eta\bracket{\mbf{x}}\epsilon_r\lapl{\phi}d\mbf{x} &= -\int_\Omega \eta\bracket{\mbf{x}}\frac{\rho\bracket{\mbf{x}}}{\epsilon_0}d\mbf{x}
      \intertext{By using formula $\nabla\cdot\bracket{f\nabla g} = \grad{f}\cdot\grad{g} + f\lapl{g}$ where $f=\eta\epsilon_r$ et $g=\phi$:}
      \nabla\cdot\bracket{\eta\epsilon_r\grad{\phi}} &= \grad{\bracket{\eta\epsilon_r}}\cdot\grad{\phi} + \eta\epsilon_r\lapl{\phi} \\
      &= \epsilon_r\grad{\eta}\cdot\grad{\phi} + \eta\grad{\epsilon_r}\cdot\grad{\phi} + \eta\epsilon_r\lapl{\phi} \\
      \Rightarrow \int_\Omega\bracket{\eta\bracket{\mbf{x}}\grad{\phi}\cdot\grad{\epsilon_r} + \eta\bracket{\mbf{x}}\epsilon_r\lapl{\phi}}d\mbf{x} &= \int_\Omega\bracket{\underbrace{\nabla\cdot\bracket{\eta\epsilon_r\grad{\phi}}}_* - \epsilon_r\grad{\eta}\cdot\grad{\phi}}d\mbf{x}
      \intertext{Using Gauss' theorem: $*= \int_{\partial\Omega}\eta\epsilon_r\grad{\phi}\cdot d\mbf{\sigma} = 0$ because $\eta\bracket{\mbf{x}}=0~\forall\mbf{x}\in\partial\Omega$ by definition.}
    \end{align*}
    \begin{equation}
      \centering
      \boxed{\int_\Omega\epsilon_r\grad{\eta}\cdot\grad{\phi}d\mbf{x} = \int_\Omega\eta\bracket{\mbf{x}}\frac{\rho\bracket{\mbf{x}}}{\epsilon_0}d\mbf{x}}
      \label{eq:variational-form}
    \end{equation}

  \subsection{Special case: cylinder} %TODO : Faut changer le titre, il pue.
    From now, the exercice will focus on a cylinder of radius $R$ and of length $L_z$ long enough to neglect the side-effects.
    Thus, $\phi\bracket{r}$, $\epsilon_r\bracket{r}$ and $\rho_\text{lib}\bracket{r}$ only depend on the radius of the cylinder, so $\grad{\eta}=\frac{d\eta}{dr}$ and $\grad{\phi}=\frac{d\phi}{dr}$.
    From equation \eqref{eq:variational-form}, the variational form of the problem can be expressed in cylindrical coordinates, which gives equation \eqref{eq:variational-form-cylindrical}.

    \begin{equation}
      \centering
      \boxed{\int_0^R r\epsilon_r\bracket{r}\frac{d\eta\bracket{r}}{dr}\frac{d\phi\bracket{r}}{dr}dr = \frac{1}{\epsilon_0}\int_0^R r\eta\bracket{r}\rho\bracket{r} dr}
      \label{eq:variational-form-cylindrical}
    \end{equation}

    Note that $r$ is added to the integral, coming from the change of variable into cylindrical coordinates.

\section{Finite elements}
  The problem need to be discretized to get a numerical solution.
  $\phi$ and $\eta$ must be expressed in a discretized way.
  Consider $\Lambda_i\bracket{r}$, the polynomials as represented on figure \ref{fig:lambda}.
  These function are used to approximate $\phi$ and $\eta$, which are given by equation \eqref{eq:approx-phi-eta}.

  \begin{equation}
    \phi\bracket{r}=\sum_j\phi_j\Lambda_j\bracket{r}~\text{and}~\eta\bracket{r}=\sum_i\eta_i\Lambda_i\bracket{r}
    \label{eq:approx-phi-eta} %TODO : Vérifier les indices. (être cohérent avec la suite surtout)
  \end{equation}

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.6\textwidth]{graphs/lambda.pdf}
    \caption{Scheme of the lambda functions}
    \label{fig:lambda}
  \end{figure}

  Using equations \eqref{eq:variational-form-cylindrical} and \eqref{eq:approx-phi-eta}, the problem can be discretized as equation \eqref{eq:discret-gen}.

  \begin{equation}
    \sum_i\eta_i\sum_j\bracket{\int_0^R r\epsilon_r\frac{d\Lambda_i}{dr}\frac{d\Lambda_j}{dr}dr}\phi_j = \sum_i\eta_i\bracket{\int_0^R\Lambda_i\frac{\rho}{\epsilon_0}dr}
    \label{eq:discret-gen}
  \end{equation}

  By identification, a system of linear equation $A\mbf{\phi}=\mbf{b}$ can be deduced, as given by equation \eqref{eq:discret-final}.

  \begin{equation}
    \sum_j\bracket{\underbrace{\int_0^R r\epsilon_r\frac{d\Lambda_i}{dr}\frac{d\Lambda_j}{dr}dr}_{A_{ij}}}\phi_j = \underbrace{\int_0^R \Lambda_i\frac{\rho}{\epsilon_0}dr}_{b_i}
    \label{eq:discret-final}
  \end{equation}



  \subsection{Writing matrix $A$ and vector $\mbf{b}$ of the linear system $A\mbf{\phi}=\mbf{b}$}\label{sec:writing-A-b1} %TODO : Changer le titre, celui-là pue.

  For both computations, the trapezoidal rule will be needed:
  \begin{equation}
    \int_a^b f\bracket{x}dx = \bracket{b-a}\frac{f\bracket{b} + f\bracket{a}}{2}
    \label{eq:trapezoidal-rule}
  \end{equation}

  First, the matrix $A$ needs to be explicited.

  \begin{equation*}
   A_{ij} = \int_0^R r\epsilon_r(r)\frac{d\Lambda_i}{dr}\frac{d\Lambda_j}{dr}dr = \sum_{k=1}^N \int_{r_{k}}^{r_{k+1}}r \epsilon_r(r)\frac{d\Lambda_i}{dr}\frac{d\Lambda_j}{dr}dr
  \end{equation*}

  Since:
  \begin{equation}
   \frac{d\Lambda_i}{dr}= \begin{cases}
   \frac{1}{h_{i-1}} \text{ over } [r_{i-1},r_i]\\
   -\frac{1}{h_{i}} \text{ over } [r_i,r_{i+1}]\\
   0 \text{ elsewhere}
                          \end{cases}
    \label{eq:lambderiv}
  \end{equation}the last term is non-zero only if $i=j$ or $i=j+1$ or $i=j-1$. Three different cases thus have to be computed: $A_{ii}$ the terms on the diagonal, $A_{i,i+1}$ and $A_{i+1,i}$, respectively under and over the diagonal. Using equation \eqref{eq:trapezoidal-rule} we get equation \eqref{eq:A-final}

  \begin{align*}
   A_{ii} &= \int_{r_{i-1}}^{r_i} r\epsilon_r(r) \frac{1}{h_{i-1}^2} dr + \int_{r_i}^{r_{i+1}} r\epsilon_r(r) \frac{1}{h_i^2} dr\\
   &= \frac{1}{2 h_{i-1}} [r_i \epsilon_r(r_i)+r_{i-1}\epsilon_r(r_{i-1})] + \frac{1}{2 h_i} [r_i \epsilon_r(r_i)+r_{i+1}\epsilon_r(r_{i+1})]\\
  \end{align*}
  and
  \begin{align*}
   A_{i+1,i} = A_{i,i+1} &= \int_{r_i}^{r_{i+1}} r\epsilon_r(r) \frac{-1}{h_i^2} dr\\
   &= -\frac{1}{2 h_i} [r_i \epsilon_r(r_i)+r_{i+1}\epsilon_r(r_{i+1})]\\
  \end{align*}

  \begin{empheq}[box=\boxed]{align}
    \begin{split}
      A_{ii} &= \frac{1}{2 h_{i-1}} [r_i \epsilon_r(r_i)+r_{i-1}\epsilon_r(r_{i-1})] + \frac{1}{2 h_i} [r_i \epsilon_r(r_i)+r_{i+1}\epsilon_r(r_{i+1})]\\
      A_{i+1,i} = A_{i,i+1} &= -\frac{1}{2 h_i} [r_i \epsilon_r(r_i)+r_{i+1}\epsilon_r(r_{i+1})]\\
    \end{split}
    \label{eq:A-final}
  \end{empheq}

  Now, vector $\mbf{b}$ needs to be explicited.

  \begin{align*}
    b_i &= \int_0^R r\Lambda_i\frac{\rho\bracket{r}}{\epsilon_0}dr = \sum_{k=1}^N \int_{r_{k}}^{r_{k+1}}r\Lambda_i\frac{\rho\bracket{r}}{\epsilon_0}dr
    \intertext{Knowing that $\Lambda_i\bracket{r_k} = \delta_{ik}$ and using the trapezoidal rule (Eq. \eqref{eq:trapezoidal-rule}):}
    &= \sum_{k=1}^N \frac{h_k}{2}\bracket{r_{k+1}\Lambda_i\bracket{r_{k+1}}\frac{\rho\bracket{r_{k+1}}}{\epsilon_0} + r_k\Lambda_i\bracket{r_k}\frac{\rho\bracket{r_k}}{\epsilon_0}} \\
    &= \frac{h_{i-1}}{2}r_i\frac{\rho\bracket{r_i}}{\epsilon_0} + \frac{h_i}{2}r_i\frac{\rho\bracket{r_i}}{\epsilon_0} = \frac{r_i\rho\bracket{r_i}}{2\epsilon_0}\bracket{h_{i-1} + h_i}
  \end{align*}

  \begin{equation}
    \boxed{b_i = \frac{r_i\rho\bracket{r_i}}{2\epsilon_0}\bracket{h_{i-1} + h_i}}
    \label{eq:b-final}
  \end{equation}

  \section{Trivial case}
  
  In this section the parameters are $b=0.06$ m, $R=0.12$ m and $N1=N2$. The trivial case $\rho_{lib}(r)=\epsilon_0$ and $\epsilon_r(r)=1$ is studied to test the algorithm.
  
  \subsection{Comparison of numerical and analytical results}

  \begin{figure}[h!]
   \centering
   \includegraphics[width=0.5\textwidth]{graphs/c_phi.eps}
   \caption{Numerical and analytical potential in function of radius for N=20}
   \label{cphi}
  \end{figure}
  
  In fig. \ref{cphi}, the potential curve obtained with the algorithm is compared to the potential curve computed analytically. The difference between the curves is of order $10^{-6}$, and gets smaller as the radius increases, until the boundary of the cylinder, on which both curves reach the boundary condition of $\phi(R)=V_0=0$ V. %TODO: expliciter le développement de la solution analytique

  \begin{figure}[h!]
   \centering
   \includegraphics[width=0.5\textwidth]{graphs/c_Er.eps}
   \caption{Electric field in function of radius for N=20}
   \label{cEr}
  \end{figure}
  
  Fig. \ref{cEr} shows that the electric field is linear with respect to the radius of the cylinder. This is expected as $E_r = -\grad{\phi(r)} = -\frac{d\phi(r)}{dr}$, and $\phi(r)$ is quadratic. There is however an anomaly, as the curve should pass through the origin $(0,0)$, since the rate of variation of $\phi(r)$ around $r=0$ is null, however the first point is slighlty displaced to the right (at around $r=1.5\times 10^{-3}$). This imprecision might come from a mistake in the matrix equation resolution algorithm, as the other groups had the same problem.
  
  \subsection{Convergence of $\phi(0)$}
  
  \begin{figure}[h]
   \centering
   \includegraphics[width=0.6\textwidth]{graphs/c_convphi.eps}
   \caption{Convergence of the error on $\phi(0)$ with respect to $N1$}
   \label{cconv}
  \end{figure}
  
  On the log-log plot of fig. \ref{cconv}, we can see that the error $|\phi(0)-\phi(0)_{th}|$ on the numerical values of $\phi(0)$ converges with order $1.828$ with respect to $N1$.

  \section{Non-trivial case}
  In this section, $b=\SI{0.02}{\m}$ and $R=\SI{0.12}{\m}$.
  Furthermore, the number of nodes on the horizontal axis and the vertical axis are linked by this relation: $N_2 = 2N_1$.
  Note that on this section, the trapezoidal rule has been used for evaluating the integrals. $\bracket{p=1\text{, see section \ref{sec:trapezoidal-middle-rule}}}$.

  \subsection{Comparison of different numerical solutions for $\phi\bracket{r}$ and $E\bracket{r}$}
  This section focuses on the comparison of the solutions of $\phi\bracket{r}$ and $E\bracket{r}$ for different meshes.
  The result can be seen on figure \ref{fig:d1-evo}.

  The first part to analyse is the point $r=b$ which is special on both figure \ref{fig:d1-evoPhi} and \ref{fig:d1-evoEr}.
  On figure \ref{fig:d1-evoPhi}, the point seems to be continuous, but is not differentiable.
  This non-differentiability leads to a discontinuity of $E\bracket{r}$ on figure \ref{fig:d1-evoEr}, as both are linked by the gradient operator.
  This discontinuity comes from the fact the point represents the junction between the dielectrics and the void. %TODO : On est d'accord que c'est le vide ?
  Physically, void does not inhibit the electric field, as no opposed electric field is present (supposing no external electric field).
  On the other hand, dielectrics contains polarisation charges that are polarized when applied to an external electric field. \cite{wiki:dielectrics}
  This polarization leads to the establishment of an electric field, which opposes to the external one.
  Thus, the resulting electric field in the dielectric is lower that in the void.
  The fact is that the interface between the void and the dielectrics is not smooth, as $\lim_{r\rightarrow b^-}\epsilon_r\bracket{r} = 1 \neq 8 = \epsilon_r\bracket{b}$, so neither is the electrical field.\\ %TODO : Il est bon ce calcul ? Le raisonnement tiens la route ou je suis déjà dans la chaussée ?

  Regarding the comparison between the meshes, the main point is that the difference between the four case is low regarding the precision.
  On both figures, a zoom is needed to really differentiate the cases.
  The first simulation ($N_1=10, N_2=20$) is the only one that slightly diverges from the others, as can be seen from the zoom in the plots.
  Thus, choosing a setting around ($N_1=40, N_2=80$) seems enough regarding the precision, as more does not change significantly the result.\\

  \begin{figure}[h]
    \centering
    \begin{subfigure}{0.45\textwidth}
      \includegraphics[width=\textwidth]{graphs/exd1-evoPhi}
      \caption{Evolution of $\phi\bracket{r}$}
      \label{fig:d1-evoPhi}
    \end{subfigure}
    ~
    \begin{subfigure}{0.45\textwidth}
      \includegraphics[width=\textwidth]{graphs/exd1-evoEr}
      \caption{Evolution of $E(r)$}
      \label{fig:d1-evoEr}
    \end{subfigure}
    \caption{Evolution of two quantities with respect to the distance $r$ from the center of the cylinder, for four simulations}
    \label{fig:d1-evo}
  \end{figure}

  \subsection{Convergence study of $\phi\bracket{r=b}$}
  This section focuses on the study of the convergence of $\phi\bracket{r}$ at $r=b$.
  Figure \ref{fig:d1-conv} gives the result of this experiment.
  The analytical solution for this problem could not be computed, so this figure does not study the error on the solution, but the final result.
  What can be seen is that $\phi\bracket{r}$ converges approximately on the 2nd order, as the plot is linear for a $1/N^2$ horizontal axis. %TODO : Ca veut dire quelque chose cette phrase ?
  This means that the value of $\phi\bracket{b}$ converges to a point quadratically. %TODO : C'est juste ?

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{graphs/exd1-convPhi.eps}
    \caption{Convergence of $\phi\bracket{r=b}$ for ten simulations. Note that $N=N_1$.}
    \label{fig:d1-conv}
  \end{figure}

  \subsection{Verification of $\Div{\mbf{D}\bracket{\mbf{x}}}$}
  This section focuses on the verification of a Maxwell's equation, $\Div{D}\bracket{\mbf{x}}$, using a finite difference method for the operator d/dr.
  Note that the problem is in cylindrical coordinates, thus $\Div{D} = \frac{1}{r}\frac{d}{dr}\bracket{r\mbf{D}}$.
  %TODO : Mettre le dev du calcul.

  Figure \ref{fig:d2} shows that the solution is exact.

  % Maxwell's law used at the beginning of section \ref{sec:equa-diff-establishment} states that the divergence of the displacement field is equal to the charge density.
  % However, this charge density considers every charges of the environment: free charges and polarization charges.

  \begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{graphs/exd2-diff.eps}
    \caption{Evolution of two quantities with respect to the distance $r$ from the center of the cylinder. Note that $N_2=2N_1=200$ for this simulation.} %TODO : La caption pue, non ?
    \label{fig:d2}
  \end{figure}

  \subsection{Computation of the polarization charge density $\rho_{pol}$}
    The goal of this paragraph is to obtain the polarization charge density of the dielectrics.
    The polarization charges are the charges on the dielectrics that can not move, which forms a multitude of electrical dipoles. \cite{feynman:dielectrics}
    The density of polarization charges can be found using equations \eqref{eq:def-polarization} and \eqref{eq:def-rhopol}.

    \begin{align}
      \mbf{P} &= \mbf{D} - \epsilon_0\mbf{E}
      \label{eq:def-polarization} \\
      \rho_{pol} &= -\Div{\mbf{P}}
      \label{eq:def-rhopol}
    \end{align}

    where $\mbf{P}$ is the polarization.
    Thus, by combining them, equation \eqref{eq:rhopol-final} follows.

    \begin{align*}
      \rho_{pol} &= -\Div{\mbf{P}} = -\nabla\cdot\bracket{\mbf{D} - \epsilon_0\mbf{E}}\\
                 &= \epsilon_0\bracket{\Div{E} - \frac{\Div{D}}{\epsilon_0}}
    \end{align*}

    \begin{equation}
      \boxed{\frac{\rho_{pol}}{\epsilon_0} = \Div{E} - \frac{\Div{D}}{\epsilon_0}}
      \label{eq:rhopol-final}
    \end{equation}

    %TODO : Introduire et analyse ce graphe

    \begin{figure}[h]
      \centering
      \includegraphics[width=0.5\textwidth]{graphs/exdii-rhopol.eps}
      \caption{Polarization charge density with respect to the distance $r$ to the center of the cylinder}
      \label{fig:rhopol}
    \end{figure}


  \subsection{Polarization charge} \lipsum[1-1]




  \section{Supplement} %TODO : Le titre de la section pue.
    \subsection{Combination of the trapezoidal rule and the middle point rule} \label{sec:trapezoidal-middle-rule}
      Section \ref{sec:writing-A-b1} described a method to describe the elements of the matrix $A$ and the vector $\mbf{b}$.
      These elements contained integral, which needed to be numerically approximated.
      To achieve this, the trapezoidal rule was used.
      An alternative method can be used to compute these integrals, which is a combination of the trapezoidal rule and the middle point rule.
      Let $f\bracket{x}$ be an integrable function.
      Then, the trapezoidal-middle point rule is given by equation \eqref{eq:int-trapeze-milieu}, where $p\in[0,1]$ is a parameter. Note that $p=1$ gives the trapezoidal rule.

      \begin{equation}
        \int_{x_k}^{x_{k+1}}f\bracket{x}dx \approx h_k\bracket{p\frac{f\bracket{x_k} + f\bracket{x_{k+1}}}{2} + \bracket{1-p}f\bracket{\frac{x_k + x_{k+1}}{2}}}
        \label{eq:int-trapeze-milieu}
      \end{equation}

      The whole process to obtain $A$ and $\mbf{b}$ will not be described, as it is similar to what was described in section \ref{sec:writing-A-b1}.
      Only the final results will be given.
      The matrix $A$ is described by equation \eqref{eq:A-final2}%TODO: Compléter cette phrase et ajouter la matrice A.

      \begin{empheq}[box=\boxed]{align}
        \begin{split}
            A_{i,i} = &\frac{1}{h_{i-1}}\sqbracket{ \frac{p}{2}\bracket{r_{i-1}\epsilon_r\bracket{r_{i-1}} + r_i\epsilon_r\bracket{r_i}} + \bracket{1-p}\alpha_{i-1}\epsilon_r\bracket{\alpha_{i-1}}} \\
            &+ \frac{1}{h_i}\sqbracket{\frac{p}{2}\bracket{r_i\epsilon_r\bracket{r_i} + r_{i+1}\epsilon_r\bracket{r_{i+1}}} +  \bracket{1-p}\alpha_i\epsilon_r\bracket{\alpha_i}}\\
            A_{i+1, i} = A_{i, i+1} = &-\frac{1}{h_i}\sqbracket{\frac{p}{2}\bracket{r_{i+1}\epsilon_r\bracket{r_{i+1}} + r_{i}\epsilon_r\bracket{r_i}} + \bracket{1-p}\alpha_{i}\epsilon_r\bracket{\alpha_i}}
        \end{split}
        \label{eq:A-final2}
      \end{empheq}

      with $\alpha_k = \frac{r_k + r_{k+1}}{2}$.
      The vector $b_i$ is described by equation \eqref{eq:b-final2}.

      \begin{equation}
        \boxed{b_i = \frac{1}{2\epsilon_0}\sqbracket{pr_i\rho\bracket{r_i}\bracket{h_i + h_{i-1}} + \bracket{1-p}\bracket{h_{i-1}\alpha_{i-1}\rho\bracket{\alpha_{i-1}} + h_i\alpha_i\rho\bracket{\alpha_i}}}}
        \label{eq:b-final2}
      \end{equation}

      with $\alpha_k = \frac{r_k + r_{k+1}}{2}$.

  \begin{thebibliography}{99}
    \bibitem{wiki:dielectrics} Wikipedia contributors, "Dielectric," Wikipedia, The Free Encyclopedia, \url{https://en.wikipedia.org/w/index.php?title=Dielectric&oldid=887928781} (accessed March 22, 2019).

    \bibitem{feynman:dielectrics} Feynman, R. (n.d.). The Feynman Lectures on Physics Vol. II Ch. 10: Dielectrics. [online] Feynmanlectures.caltech.edu. Available at: \url{http://www.feynmanlectures.caltech.edu/II_10.html} [Accessed 18 Mar. 2019].
  \end{thebibliography}

\end{document}
