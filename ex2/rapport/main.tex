% debut d'un fichier latex standard
\documentclass[a4paper,12pt,twoside]{article}

% Pour les unités SI
\usepackage{siunitx}
% pour l'inclusion de figures en eps,pdf,jpg
\usepackage{graphicx}
% quelques symboles mathematiques en plus
\usepackage{amsmath}
% le tout en langue francaise
%\usepackage[english]{babel}
% on peut ecrire directement les caracteres avec l'accent
% a utiliser sur Linux/Windows
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% pour faire des systèmes d'équations
\usepackage{systeme}

% a utiliser sur le Mac
%\usepackage[applemac]{inputenc}
% pour l'inclusion de links dans le document
\usepackage[colorlinks,bookmarks=false,linkcolor=blue,urlcolor=blue]{hyperref}
\usepackage{subcaption}
\paperheight=297mm
\paperwidth=210mm

\setlength{\textheight}{235mm}
\setlength{\topmargin}{-1.2cm} % pour centrer la page verticalement
%\setlength{\footskip}{5mm}
\setlength{\textwidth}{15cm}
\setlength{\oddsidemargin}{0.56cm}
\setlength{\evensidemargin}{0.56cm}

\pagestyle{plain}

% quelques abreviations utiles
\def \be {\begin{equation}}
\def \ee {\end{equation}}
\def \dd  {{\rm d}}

\newcommand{\mail}[1]{{\href{mailto:#1}{#1}}}
\newcommand{\ftplink}[1]{{\href{ftp://#1}{#1}}}
%
% latex SqueletteRapport.tex      % compile la source LaTeX
% xdvi SqueletteRapport.dvi &     % visualise le resultat
% dvips -t a4 -o SqueletteRapport.ps SqueletteRapport % produit un PostScript
% ps2pdf SqueletteRapport.ps      % convertit en pdf

% pdflatex SqueletteRapport.pdf    % compile et produit un pdf

% ======= Le document commence ici ======

\begin{document}
% Le titre, l'auteur et la date
\title{Particle in an electromagnetic field\\{\small Physique Numérique I}\\{\small 2nd report}}
\date{\today}
\author{Delphine Martres and Damien Korber\\{\small \mail{delphine.martres@epfl.ch} and \mail{damien.korber@epfl.ch}}}
\maketitle
\tableofcontents % Table des matieres

% Quelques options pour les espacements entre lignes, l'identation
% des nouveaux paragraphes, et l'espacement entre paragraphes
\baselineskip=16pt
\parindent=15pt
\parskip=5pt



%%%% ON COMMENCE A ECRIRE D'ICI

\section{Introduction}


\section{Analytic computations}
\subsection{Establishment of the linear equation system}
After some computations that can be found in annex \ref{ann:dev-eq-diff}, the system \ref{eq:equa-diff} results.

\begin{equation}
\systeme*{m\ddot{x} = Bq\dot{y}, m\ddot{y} = qE - Bq\dot{x}}
\label{eq:equa-diff}
\end{equation}

The equation on $z$ axis is neglected because no informations can be obtained from it.

\subsection{Analytics solutions with an null electric field}

\subsection{Center of cercle for a particular radius}

\section{Study of three numerical methods}
In this section, the electric field $E = 0$.
\subsection{Trajectory comparaison}
In this experiment, the initial vertical velocity is equal to $v_0 = \SI{4d5}{\meter\per\second}$ and the constant magnetic field is $B_0 = \SI{3}{\tesla}$.
The simulation stops after the proton has done five revolutions.\\
\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\linewidth]{graphs/ex2_ii_traj.eps}
	\caption{Comparaison of trajectories from the proton using differents methods, with 1 000 steps.}
	\label{fig:ex2-ii-traj}
\end{figure}
The figure \ref{fig:ex2-ii-traj} shows a comparaison of the trajectories the proton followed with the use if different integration methods.
The main point to notice is the inusability of Euler method in this experiment.
With this method, the proton seems to follow a circular trajectory with a non-constant radius, and that is a problem.
The proton is supposed to follow a circular trajectory with a constant radius.
This problem comes directly from the idea of Euler's method itself.
When it evaluates the next iteration, it uses  the tangent.%TODO: Vérifier que ce soit juste
So after every iteration, a little error evaluated, and it will cumulates.
So Euler method is easy to implement, but is unusable in this case.\\

The second point to notice is the light difference between Euler-Cromer and Runge Kutta 2 methods.
Euler-Cromer method approximates pretty well the trajectory.
It is not a perfect cercle, but is way better that Euler's method.
%TODO: Parler de la raison mathématique pourquoi Euler-Cromer > Euler.
The last method is Runge Kutta of second order.
It is the best of the three methods to approximates the solution.
The trajectory is close the a perfect circle, and every revolutions are stacked on each others.

\subsection{Convergence study}
This section focuses on a convergence study of all three methods used in this experiment, and will compare them.
\begin{figure}[h]
\centering
\begin{subfigure}[t]{0.45\textwidth}
	\includegraphics[width=\textwidth]{graphs/app1_conv_ALL.eps}
	\caption{Convergence graph where three methods are drawn.}
	\label{fig:app1-conv-ALL}
\end{subfigure}
~
\begin{subfigure}[t]{0.45\textwidth}
	\includegraphics[width=\textwidth]{graphs/app1_conv_noEuler.eps}
	\vfill
	\caption{Convergence graph where Euler's method isn't drawn for readability reasons.}
	\label{fig:app1-conv-noEuler}
\end{subfigure}
\caption{Convergence graph comparing Euler, Euler Cromer and Runge Kutta of 2nd order's methods.}
\label{fig:app1-conv}
\end{figure}

% TODO: Faire l'analyse des graphs ci-dessus.


%TODO: Je crois que ce qui est commenté, là, est juste faux et c'est du grand n'importe quoi.
%In the figure \ref{fig:app1-conv-ALL}, the main information is fact that Euler's method is not appropriate for this simulation.
%The error explodes really quickly, and just keep increasing.
%The problem with this figure, is that the others methods can not be analysed.
%The figure \ref{fig:app1-conv-noEuler} fixes the problem by focusing on the others methods.
%This second figures shows the stability of both methods.
%Euler-Cromer clearly is better than Euler's one.
%But the error seems to keep increasing, which is bad for long simulation.
%Aside from that, the method can be used for small simulation of the same kind.
%On the other hand, Runge-Kutta of order 2 is a good option.
%The main difference between this method and the two others is the stability.
%In this case, the error decreases, which implies stability.
%For long simulation, Runge-Kutta of second order is a good option for this kind of simulation.

\section{Applications}
\subsection{Dérive $E\times B$} %TODO: Traduire "Dérive"
In this experiement, the proton is now subjected to an electric field $E=\SI{6d4}{\volt\per\meter}$, as well as a constant magnetic field $B_0 = \SI{3}{\tesla}$.
The proton starts with an initial velocity of $v_{0x}=\SI{0}{\meter\per\second}$ and $v_{0y}=\SI{4d5}{\meter\per\second}$, and the simulation will last the time it take for the proton to end five revolutions.
\subsubsection{Convergence study}%TODO: Changer le titre


\subsubsection{Analysis of simulations}
\begin{figure}[h]
\begin{subfigure}[t]{0.32\textwidth}
	\includegraphics[width=\textwidth]{graphs/app1_ii_ene.eps}
	\caption{Graph showing the energy of the proton over time.}
	\label{fig:app1-ii-ene}
\end{subfigure}
~
\begin{subfigure}[t]{0.32\textwidth}
	\includegraphics[width=\textwidth]{graphs/app1_ii_traj.eps}
	\caption{Graph showing the trajectory of the proton.}
	\label{fig:app1-ii-traj}
\end{subfigure}
~
\begin{subfigure}[t]{0.32\textwidth}
	\includegraphics[width=\textwidth]{graphs/app1_ii_vit.eps}
	\caption{Graph showing the vertical speed in function of horizontal speed of the proto}
	\label{fig:app1-ii-vit}
\end{subfigure}
\caption{Graphs describing the proton in both electric and magnetic fields. The parameter are the one asked, the integration method is Runge-Kutta of 2nd order, and the number of steps is \SI{1000}{}.}
\label{fig:app1_ii}
\end{figure}

The figure \ref{fig:app1-ii-ene} show the energy of the proton over time.
On first glance, this figure may look odd.
The proton seems to gain energy over time, which is impossible in this problem.
But taking a look at the scale of the figure is a good idea. %TODO: j'aime pas cette phrase.
The difference of energy between during the experiment is of order $\SI{d-23}{}$.
That's really small compared to the energy of the proton at anytime.
To get an idea of how small it is, the mean slope is useful.
In this case, the mean slope is of $\SI{d-16}{}$, which implies an almost horizontal line.
The problem probably comes from the computer itself.
Each time it makes a computation, some results are rounded.
These rounding implies that the following computations are not exact, and through time, it accumulates and create a small difference.
Therefore, energy can be considered as conserved.\\

The figures \ref{fig:app1-ii-traj} and \ref{fig:app1-ii-vit} show the trajectory and the speeds of the proton for the times the proton takes to achieve five revolutions.
The most interesting point to notice is the fact that the trajectory looks like a circle.
The figure is misleading, but the scale shows it.
All revolutions look stacked, which confirms that the energy is conserved in this experiment.
If it were not, the trajectory would be a spiral.
The same analysis is performed for the second figure.
All revolutions are stacked, the curve looks like a circle, so energy must be conserved.\\

%To ensure that the energy is conserved, a much longer simulation should be done.
%Here, only five revolutions are considered, but what about a much longer simulation ?
%The experiments has been retried with a much larger simulation time ($tfin=\SI{1.09321e-4}{\second}$), and a much heigher number of steps ($nsteps=\SI{10000000}{}$).
%TODO: On est d'accord que ce qui est commenté ne sert à rien ? J'ai fait les graphs, et y'a pas grand chose à dire.

\subsubsection{Proton in an accelerated referential}

\subsubsection{Dérive $\nabla B$} %TODO: Traduire "Dérive"

\section{Further analysis...}

\appendix
\section*{Annexes}
\addcontentsline{toc}{section}{Annexes}

\section{Differential equation development} \label{ann:dev-eq-diff}
The mass of the proton is so small, that the gravitational force is ignored in these experiments.
Then the only force remaining is Lorentz's force.

\begin{equation}
	\vec{F}_L = q(\vec{E} + \vec{v}\times\vec{B})
	\label{eq:lorentz-force}
\end{equation}

Using Newton's second law, three equations results.

\begin{align*}
	\Sigma\vec{F}^{ext} &= m\vec{a} \\
	\vec{F}_L &= m\vec{a}\\
	q(\vec{E} + \vec{v}\times\vec{B}) &= m\vec{a} \\
	q\left( \begin{pmatrix} 0\\ E\\ 0\\ \end{pmatrix} + \begin{pmatrix} \dot{x}\\ \dot{y}\\ 0\\ \end{pmatrix} \times \begin{pmatrix} 0\\ 0\\ B\\ \end{pmatrix}\right) &= m\begin{pmatrix} \ddot{x}\\ \ddot{y}\\ \ddot{z}\\ \end{pmatrix} \\
	\frac{q}{m}\begin{pmatrix} B\dot{y}\\ E - B\dot{x}\\ 0 \end{pmatrix} &= \begin{pmatrix} \ddot{x}\\ \ddot{y}\\ \ddot{z}\\ \end{pmatrix}
\end{align*}

The last equation is not useful for what is about to come.
The system of differential equation resulting is equation \ref{eq:equa-diff}.

\end{document}
