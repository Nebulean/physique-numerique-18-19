% debut d'un fichier latex standard
\documentclass[a4paper,12pt,twoside]{article}

% pour l'inclusion de figures en eps,pdf,jpg
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{wrapfig}
% quelques symboles mathematiques en plus
\usepackage{amsmath}
% le tout en langue francaise
%\usepackage[french]{babel}
% on peut ecrire directement les caracteres avec l'accent
% a utiliser sur Linux/Windows
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
% a utiliser sur le Mac
%\usepackage[applemac]{inputenc}
% pour l'inclusion de links dans le document
\usepackage[colorlinks,bookmarks=false,linkcolor=blue,urlcolor=blue]{hyperref}
\usepackage{siunitx}

\paperheight=297mm
\paperwidth=210mm

\setlength{\textheight}{235mm}
\setlength{\topmargin}{-1.2cm} % pour centrer la page verticalement
%\setlength{\footskip}{5mm}
\setlength{\textwidth}{15cm}
\setlength{\oddsidemargin}{0.56cm}
\setlength{\evensidemargin}{0.56cm}

\pagestyle{plain}

% quelques abreviations utiles
\def \be {\begin{equation}}
\def \ee {\end{equation}}
\def \dd  {{\rm d}}

\newcommand{\mail}[1]{{\href{mailto:#1}{#1}}}
\newcommand{\ftplink}[1]{{\href{ftp://#1}{#1}}}
%
% latex SqueletteRapport.tex      % compile la source LaTeX
% xdvi SqueletteRapport.dvi &     % visualise le resultat
% dvips -t a4 -o SqueletteRapport.ps SqueletteRapport % produit un PostScript
% ps2pdf SqueletteRapport.ps      % convertit en pdf

% pdflatex SqueletteRapport.pdf    % compile et produit un pdf

% ======= Le document commence ici ======

\begin{document}
% Le titre, l'auteur et la date
\title{Gravitational systems.\\{\small Apollo 13, atmosphere re-entry and Trojan asteroids \\ Physique Numérique I}\\{\small Rapport 4}}
\date{\today}
\author{Delphine Martres et Damien Korber\\{\small \mail{delphine.martres@epfl.ch} et \mail{damien.korber@epfl.ch}}}
\maketitle
\tableofcontents % Table des matieres

% Quelques options pour les espacements entre lignes, l'identation
% des nouveaux paragraphes, et l'espacement entre paragraphes
\baselineskip=16pt
\parindent=15pt
\parskip=5pt
\newpage


%%%% ON COMMENCE A ECRIRE D'ICI

\section{Introduction}

\section{"Houston, we've had a problem"}
Apollo 13 is located at a distance $r_0 = \SI{314159}{\kilo\meter}$ from the center of Earth.
Its velocity with respect to earth's frame of reference is $v_0 = \SI{1.2}{\kilo\meter\per\second}$.
Because of a fuel shortage, the norm of speed can not be changed.
However, it is possible to ajust its direction.
To bring back Apollo 13's crew, their trajectory needs to get as close as $h=\SI{10}{\kilo\meter}$ to the surface of earth, the distance where the atmosphere is dense enough to slow the ship and break its orbit.
In this experiment, the Moon will be ignored and the mass of Apollo 13 is negligible compared to Earth's mass. Then, it will be a 1 body gravitational problem.

\subsection{Initial velocity of Apollo 13}
The goal of this section is to find the components of the velocity of the probe, so that it gets on an orbit close to earth, at \SI{10}{\kilo\meter}. When neglecting the effect of the atmosphere, Apollo is only subjected to the gravitational forces of Earth and Moon, which are conservative forces. Therefore we can use conservation of mechanical energy and conservation of angular momentum to solve for the initial velocity.

\subsubsection{Conservation of mechanical energy}
The mechanical energy of the probe at any moment is given by equation \eqref{eq:1a-em-apollo13}.
\begin{equation}
  E_m = \frac{1}{2}mv^2 - G\frac{mM}{r}
  \label{eq:1a-em-apollo13}
\end{equation}
where $m=\SI{5809}{\kilo\gram}$ is the mass of the probe, $M=\SI{5.972d24}{\kilo\gram}$ is the mass of earth, $G=\SI{6.674d-11}{\cubic\meter\per\kilo\gram\per\square\second}$ is the gravitational constant, $v$ is the speed of the probe with respect to earth's frame of reference, and $r$ is the distance between the probe and the center of Earth.\\

By conservation of mechanical energy, two moments are chosen.
\begin{itemize}
  \item $t=\SI{0}{\s}: E_{m,t_0} = \frac{1}{2}mv_0^2 - G\frac{mM}{r_0}$
  \item $t=t_{end}: E_{m,t_{end}} = \frac{1}{2}mv_{end}^2 - G\frac{mM}{h + R_t}$
\end{itemize}
where $v_0 = \SI{1.2}{\kilo\meter\per\second}$ is the initial velocity of Apollo 13, $r_0 = \SI{314159}{\kilo\meter}$ is the initial distance between Apollo 13 and the center of earth, and $v_{end}=v_{max}$ is the velocity of Apollo at its closest point to Earth, and its maximum velocity, by the second law of Kepler.
Thus, solving $E_{m,t_0} = E_{m,t_{end}}$, the velocity of the probe when it is at a distance $h=\SI{10}{\kilo\meter}$ of earth can be found, and is given by equation \eqref{eq:1a-vitesse-finale}.

\begin{equation}
  v_{end} = v_{max} = \sqrt{v_0^2 + 2GM\left(\frac{1}{h + R_t} - \frac{1}{r_0}\right)} = \SI{11121.52}{\meter\per\second}
  \label{eq:1a-vitesse-finale}
\end{equation}

\subsubsection{Conservation of angular momentum}
The angular momentum of the probe at any moment is given by equation \eqref{eq:momcin}.
\begin{equation}
L = mr^2 \omega
\label{eq:momcin}
\end{equation}
where $\omega$ is the angular velocity of the probe. From $ L_{t_0} = L{t_{end}} $ we get equation \eqref{eq:momcin2} with the polar coordinates $(r,\theta)$ centered on the center of the Earth.
\begin{equation}
v_{\theta 0} = \frac{(h+R_t)^2}{r_0^2} v_{\theta end}
\label{eq:momcin2}
\end{equation}

Since $v_{end}$ is at the lowest point of the orbit, $v_{end} = v_{\theta end}$. If Apollo is initially aligned with the Earth on the $y$ axis in cartesian coordinates, then at the initial position $\hat{e}_r$ is aligned with $\hat{e}_y$ and $\hat{e}_\theta$ is aligned with $\hat{e}_x$. Therefore $v_{x0} = v_{\theta 0} = 226.145~\si{\m \per \s}$ and $v_{y0} = \sqrt{v_0^2 - v_{x0}^2} = -1178.498~\si{\m \per \s}$.


%\subsubsection{Maximum velocity of the probe}
%The maximum velocity of the probe on this given situation is given by equation \eqref{eq:1a-vitesse-finale} because since the gravitational force is the only one considered, the maximum velocity is given by the moment where the distance is minimal, which is $h_{min}$ in this situation.
%Thus, after some computation, the maximum velocity reached by Apollo 13 is given by equation \eqref{eq:1a-vitesse-max}.
%
%\begin{equation}
%  v_{max} = \SI{11121.52}{\meter\per\second}
%  \label{eq:1a-vitesse-max}
%\end{equation}




\subsection{Numerical analysis with a non-adaptative time step}
In this section, the simulation of the previous simulation will be computed numerically, using the numerical method: Runge-Kutta of order 4 (RK4).

\subsubsection{Trajectory}\label{sec:1b_traj}
The trajectory of Apollo 13 and earth are represented in figure \ref{fig:1b_traj}.
In this figure, earth is considered circular and is drawn at the right scale.
The green cross represents the initial position of Apollo 13, and the green points are its trajectory.
On this figure, the probe seems to come close to Earth, but as drag is not considered, it is not slowed down.
This implies that the probe gains speed by coming closer to Earth, and then, it continues its path.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{graphs/ex1b_traj.eps}
  \caption{Trajectory of Apollo 13 (in green, where the cross is its initial position) with Earth (in blue) at the correct scale. The simulation ran with $dt=\SI{50}{\s}$ over \SI{172800}{\s}, and \num{3457} steps where computed.}
  \label{fig:1b_traj}
\end{figure}

\subsubsection{Convergence studies: $h_{min}$ and $v_{max}$}
To study the convergence of RK4, the minimal distance between Earth's surface and Apollo 13, and the maximal speed of Apollo 13 will be studied.
The convergence studies are represented in figure \ref{fig:1b_conv}.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex1b_conv_h.eps}
    \caption{Convergence study on the minimum distance between Apollo 13 and the earth.}
    \label{fig:1b_conv_hmin}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex1b_conv_vel.eps}
    \caption{Convergence study on the maximum velocity of Apollo 13.}
    \label{fig:1b_conv_vmax}
  \end{subfigure}
  \caption{Convergence studies for 10 simulation, with a final time of \SI{172800}{\s} (which is two days).}
  \label{fig:1b_conv}
\end{figure}

The first information to extract from figure \ref{fig:1b_conv} is the fact that both parameters converges.
On figure \ref{fig:1b_conv_hmin}, it can be seen that the error on the minimal distance gets really small, \num{d-3} meters, with respect to the distances considered, which are hundred thousands of kilometers.
The same applies for figure \ref{fig:1b_conv_vmax}, where the error becomes small too.
Thus, RK4 seems to be a good numerical method to get precise results.
The next point is to analyse is the order of convergence, which is given by the slope of the linear regressions.
In both cases, the slope is close to $4$, which is what was expected for a fourth-order numerical method.
Thus, RK4 converges on the expected order for this simulation.

\subsection{Numerical analysis with an adaptative time step}
This time, the same situation is computed numerically, but with an adaptative time step.
It means that, for each steps, the time step is modified, to obtain a particular precision.
It allows to use greater time steps when the evolution is slightly changing, and to use smaller time steps when the evolution is greatly changing.
Thus, it should greatly reduce the number of steps required to do a simulation.

\subsubsection{Trajectory}
The trajectory of the probe is computed with the same conditions than in section \ref{sec:1b_traj}, with the adaptative time step enabled.
Thus, it is possible to compare both results.
The trajectory of the probe is represented in figure \ref{fig:1c_traj}.

\begin{figure}
  \centering
  \includegraphics[width=0.5\textwidth]{graphs/ex1c_traj.eps}
  \caption{Trajectory of Apollo 13 (in green, where the cross is its initial position) with Earth (in blue) at the correct scale. The simulation ran with $\epsilon=\SI{d-5}{\m}$ over \SI{172800}{\s}, and \num{1162} steps where computed.}
  \label{fig:1c_traj}
\end{figure}

%TODO: Faire une comparaison des deux trajectoires (1c_traj et 1b_traj), notamment avec les nsteps.
The most important comparison to make between the adaptative and non-adaptative time step's simulations, is the number of steps required to achieve them.
For the non-adaptative time step (fig. \ref{fig:1b_traj}), \num{3457} steps where required to get the solution, but for the adaptative time step (fig. \ref{fig:1c_traj}), \num{1162} steps where required, which is three times less.
On a such simple simulation, the difference between both results is not so significant, as both of them computes quickly.
But on really big simulations (considering millions of steps), this different is not negligible.
Also, the adaptative time step simulation used a high precision of $\epsilon=\SI{d-5}{\m}$, which may be unnecessary in some sitation.
With a precision of \SI{d-3}{\m}, the solution is already quite good for some problems, and it requires much fewer time steps to be computed.

\subsubsection{Convergence study on the precision}
The adaptative time step is controlled by a factor, $\epsilon$, which provides the precision that the next step has to reach.
By varying $\epsilon$, the convergence of $h_{min}$ with respect to the number of steps can be studied.
The resulting study is represented in figure \ref{fig:1c_conveps_h}, and figure \ref{fig:1c_conveps_dt} represents the evolution of dt over time for one of the simulation.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex1c_conveps_h.eps}
    \caption{Convergence study of the minimum distance between Apollo 13 and the Earth.}
    \label{fig:1c_conveps_h}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex1c_conveps_dt.eps}
    \caption{Evolution of the time step over time for $\epsilon=\SI{1e-5}{\m}$, and \num{1162} steps were computed.}
    \label{fig:1c_conveps_dt}
  \end{subfigure}
  \caption{Simulations using an adaptative time step. All of the simulations were ran for $\SI{172800}{\s}$.}
  \label{fig:1c_conveps}
\end{figure}

Figure \ref{fig:1c_conveps_h} shows that RK4 converges to the real minimum distance, as the error keeps decreasing linearly (on a log-log plot).
Furthermore, the slope of the linear regression is estimated to $4$, which is the expected order of convergence of RK4.
Figure \ref{fig:1c_conveps_dt} shows the evolution of dt over time, thus shows how the adaptative time steps works.
As the probe approaches Earth, dt keeps decreasing, because of the increasing speed of the probe.
But as soon the probe overtakes Earth, the speed starts decreasing and dt starts increasing.
This result is as expected, and shows that the adaptative time step functions as expected.

\section{"Houston, we're going to have a real problem"}
In this section, the atmosphere of Earth will be considered.
This allows the probe to return to the ground, hopefully safely.

\subsection{Earth re-entry without modifying the initial conditions}
This section studies the possibilities for Apollo 13 to return to Earth, when no modification to the trajectory is applied.\\

First, the trajectory of the probe is represented, to get an idea of the behavious of the probe.
Figure \ref{fig:2a_traj} represents the trajectory of Apollo 13.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex2a_traj_full.eps}
    \caption{Full trajectory.}
    \label{fig:2a_traj_full}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex2a_traj_close.eps}
    \caption{Closer look of figure \ref{fig:2a_traj_full}.}
    \label{fig:fig:2a_traj_close}
  \end{subfigure}
  \caption{Trajectory of Apollo 13 (in green, where the cross is the initial position), and the Earth (in blue) at the right scale. The simulation was supposed to run for \SI{172800}{\s} with an adaptative time step of $\epsilon=\SI{1d-5}{\m}$ but was stopped after \SI{159483}{\s} because Apollo 13 crashed into Earth.}
  \label{fig:2a_traj}
\end{figure}

%TODO: Analyser le graph.

Using these conditions, the maximum acceleration that was experienced by the probe is given by equation \eqref{eq:2a_maxAccel}.

\begin{equation}
  a_\text{max} = \SI{220.53}{\meter\per\square\second} = \num{22.49}\text{ g}
  \label{eq:2a_maxAccel}
\end{equation}

This acceleration is unbearable for any humain, and probably any other mammals.
To get a comparison, astronauts can experience around $\num{3}\text{ G}$ during a liftoff \cite{nasa:ask_the_crew}, but they are experimented and equipped with g-suits, which reduces the impact of acceleration \cite{wiki:g-suit} on the body. To complete this analysis, a convergence study of the maximum acceleration is given by figure \ref{fig:2a_conv}.\\

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{graphs/ex2a_conv.eps}
  \caption{Convergence study of the error on the maximum acceleration with respect to the number of steps considered. The range of precisions considered is $\epsilon \in [\SI{d-4}{\m}, \SI{1}{\m}]$}
  \label{fig:2a_conv}
\end{figure}

First, it is important to say that the maximum acceleration can not be exactly found, because there is no analytical solution to this problem.
Thus, to consider the error on the maximum acceleration, all the values were compared to the most precise value of the maximum acceleration, which is the one given in equation \eqref{eq:2a_maxAccel}.
On figure \ref{fig:2a_conv}, the main point is the slope of the convergence.
This slope is approximately $4$, which is the expected order of convergence for RK4.
It can also be seen that the error is quite small compared to the considered maximum acceleration, which is given by equation \eqref{eq:2a_maxAccel}.
Thus, RK4 is once again proven to be converging at the right order, and fits the situation well.

The maximum power of the air resistance is given by equation \eqref{eq:2a_maxPower}.

\begin{equation}
  P_{max}(\mathbf{f_\text{drag}}) = \SI{9672252913}{\watt}
  \label{eq:2a_maxPower}
\end{equation}

Equation \eqref{eq:2a_maxPower} describes the maximal power of drag, applied to the probe.
No references has been found to compare this value, but it seems considerable, as a high power applied to the probe will heat it, and in this case, will probably melt it.

Thus, returning to Earth using the current trajectory is not possible, and another method must be found, which is the topic of next section.


\subsection{Rotating the probe to get the minimal acceleration}
\label{sec:minaccel}
This section will focus on a way to minimize the acceleration underwent by the astronauts in Apollo 13.

The method is quite simple: slightly changing the direction of the initial velocity of the probe.
To achieve this, the initial velocity will be rotated by an angle $\theta$ that will be found in an empirical way.
Note that the probe must land on its first entry in the atmosphere: it should not slow with multiples periods around earth. %TODO : Je trouve cette phrase pas très belle.

Let $\mathbf{v} = \begin{pmatrix} v_1, v_2\end{pmatrix}$ be the initial velocity and $\mathbf{w} = \begin{pmatrix} w_1, w_2\end{pmatrix}$ be the rotated initial velocity.
Both velocities are linked by the rotation matrix, and their relation is given by equation \eqref{eq:v_rotation}.

\begin{equation}
  \begin{pmatrix}
    w_1 \\
    w_2
  \end{pmatrix}
  =
  \begin{pmatrix}
    \cos\theta & -\sin\theta \\
    \sin\theta & \cos\theta
  \end{pmatrix}
  \begin{pmatrix}
    v_1 \\
    v_2 \\
  \end{pmatrix}
  =
  \begin{pmatrix}
    v_1\cos\theta - v_2\sin\theta \\
    v_1\sin\theta + v_2\cos\theta
  \end{pmatrix}
  \label{eq:v_rotation}
\end{equation}

To find the right angle $\theta$ minimizing the acceleration, the plot of the maximum acceleration for a given angle, and the trajectory of the probe, will be used.

Denote $i$ the process number, $\phi_0$ an arbitrary angle and $\Theta_0 = \SI{0}{\radian}$ an angle.
First, an arbitrary range of angles are selected: $A_0 = [\Theta_0-\phi_0, \Theta_0+\phi_0]$.
The rotated velocities $\mathbf{w}$ are computed and stored, for $N$ angles contained in $A$.
These velocities are inserted as the initial velocities, and all the simulations are made.
Next, the two plot cited above are created and analysed.
The plot of trajectory gives an idea of the angles to ignore (those where the probe does not land on the period).
Regarding the left angles, the plot of maximum acceleration gives the best angle in this range, the one giving the smallest maximum acceleration. This angle is denoted by $\Theta_1$.
The process is restarted with a new range of angles $A_1 = [\Theta_1 - \phi_1, \Theta_1 + \phi_1]$, where $\phi_1 < \phi_0$.
By looping $k$ times, until the moment where the minimal acceleration only slightly changes over analysis,  one of the best angle is found.
This angle is given by $\theta = \Theta_k$.

To illustate this method, figure \ref{fig:ex5b_maxaccel} gives an example of the plots that can be made for one process.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\textwidth]{graphs/ex5b_maxaccel.eps}
  \caption{Maximum of the acceleration of all simulations. Note that the line at the bottom is a problem in the simulations, which hasn't been solved (no solutions were found), but it does not affect any results.}
  \label{fig:ex5b_maxaccel}
\end{figure}

% \begin{figure}[h]
%   \centering
%   \begin{subfigure}[t]{0.45\textwidth}
%     \includegraphics[width=\textwidth]{graphs/ex2b_convacc.eps}
%     \caption{Maximum acceleration of all simulations.}
%     \label{fig:2b_min_a_traj}
%   \end{subfigure}
%   ~
%   \begin{subfigure}[t]{0.45\textwidth}
%     \includegraphics[width=\textwidth]{graphs/ex2b_traj.eps}
%     \caption{Trajectories for a given angle. Different colors means different different rotation angles. The legend was removed for readability reasons.}
%     \label{fig:2b_min_a_comp}
%   \end{subfigure}
%   \caption{Study of the trajectory and the maximum acceleration for \num{10} simulations, using an adaptative time step of $\epsilon=1e-4$. The angles of rotations used are contained in the range $[-\frac{\pi}{50}, \frac{\pi}{50}]$.}
%   \label{fig:2b_min_a}
% \end{figure}

The angle of rotation found using this processes is given by equation \eqref{eq:2b_a_min_angle}.

\begin{equation}
  \theta \approx \SI{3.303d-2}{\radian}
  \label{eq:2b_a_min_angle}
\end{equation}

The norm of the smallest maximal acceleration, found using angle of equation \eqref{eq:2b_a_min_angle}, is given by equation \eqref{eq:2b_a_min}.

\begin{equation}
  a = \SI{63.27}{\meter\per\square\second} \approx \num{6.45}\text{ g} %TODO : Compléter ce résultat.
  \label{eq:2b_a_min}
\end{equation}

The acceleration in equation \eqref{eq:2b_a_min} is much smaller than the initial acceleration (eq. \eqref{eq:2a_maxAccel}), and is closer to the maximum acceleration astronauts are subjected to.
However, it is still non-negligible, and astronauts will probably pass out at that point, but at least, they will land in one piece.

\section{Two bodies: Earth and Moon}
In this section the 2-body system Earth-Moon is studied. The distance between the Earth and the Moon is $d = 384748 ~\si{\km}$.

\subsection{Uniform circular trajectories}
We will consider a uniform circular trajectory for both objects in the frame of reference of the center of mass $G$ of the system Earth-Moon. The position of $G$ is given by equation \eqref{eq:CM}.
\begin{equation}
\mathbf{r_G} = \frac{m_L \mathbf{r_L} + m_T \mathbf{r_T}}{m_L + m_T}
\label{eq:CM}
\end{equation}
If the Earth and the Moon are aligned on the x axis, we get $x_G = 4.676244537 \times 10^6 ~\si{\m}$ in the geocentric frame of reference. Hence, in the frame of reference of $G$, the positions of the Earth and Moon aligned on the x axis are $x_T = -4.676244537 \times 10^6 ~\si{\m}$ and $x_L = d-x_G = 3.800717555 \times 10^8 ~\si{\m}$.\\
From the expression of the gravitational force $ma = G m_T m_L/d^2$ and the expression of the acceleration of an object in a uniform circular trajectory $a = v^2/R$ with R the radius of the trajectory, we get the expression of the initial velocity for object $i$ ($i \neq j$) in equation \eqref{eq:MCUvit}.
\begin{equation}
v_i = \frac{\sqrt{RG m_j}}{d}
\label{eq:MCUvit}
\end{equation}
Hence, choosing a clockwise rotation, the Earth's initial velocity is $v_T = 12.44632236 ~\si{\m \per \s}$ and the Moon's initial velocity is $v_L = -1011.601415~\si{\m \per \s}$. The trajectories with these initial conditions are shown on fig.\ref{fig:4_traj}.

\subsection{Conservation of quantities}
Since the only force applied on both objects is a conservative force, the mechanical energies and momentum are conserved. As their trajectory is a uniform circle, their distance with respect to each other is also conserved. Fig. \ref{fig:4emec} shows the mechanical energy of the Earth and the Moon over time, fig. \ref{fig:4p} shows their momentum over time, and fig. \ref{fig:4d} shows their distance over time. All of these simulations were done over $25228000$ s or about 292 days, so that the system performed around ten revolutions, and with $\epsilon = 1 \cdot 10^{-4}$.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.48\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex4b_emece.eps}
    \caption{Mechanical energy of the Earth}
    \label{fig:emece}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.48\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex4b_emecl.eps}
    \caption{Mechanical energy of the Moon}
    \label{fig:emecl}
  \end{subfigure}
  \caption{Mechanical energy of both objects over ten revolutions}
  \label{fig:4emec}
\end{figure}

All of these quantities for both objects oscillate over time, although they are conserved on average. The amplitude of the oscillations of the mechanical energy is of order $10^{24}$ for the Earth and of order $10^{22}$ for the Moon, which are both quite small compared to the order of magnitude of $10^28$ for their mechanical energies.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.48\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex4b_p.eps}
    \caption{Momentum of the Earth and Moon}
    \label{fig:4p}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.48\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex4b_d.eps}
    \caption{Distance between the Earth and the Moon}
    \label{fig:4d}
  \end{subfigure}
  \caption{Other conservative quantities of both objects over ten revolutions}
  \label{fig:4cons}
\end{figure}

The amplitude of the oscillations of the momentum are of order $10^{22}$ for an order of magnitude of $10^{25}$ for the momentum of both objects. The difference between their momenta is not visible at this scale, however by zooming in, it can be observed that the maximum difference is of order $10^{16}$.\\
The amplitude of the oscillations of the distance between the Earth and the Moon is of order $10^4$ for an order of magnitude of $10^8$ for the distance. The average distance is $\SI{3.84744028d8}{\m}$.\\
In all of these cases the oscillations can be explained by the approximations made by the Runge-Kutta numerical method.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{graphs/ex4_traj.eps}
  \caption{Trajectories of the Earth and the Moon in a uniform circular motion in the frame of reference of the center of gravity $G$}
  \label{fig:4_traj}
\end{figure}

\section{Three bodies: Earth, Moon and Apollo 13}
Now we add Apollo to the previous system so that we get a 3-body system. As the frame of reference used is now that of the center of gravity $G$, the initial position and velocity of Apollo need to be changed accordingly. With Earth, Apollo and the Moon aligned on the x-axis, we get Apollo's initial position $x_A = \SI{309482755.5}{\m}$. To the initial velocity in the geocentric frame of reference, the effect rotation of the Earth in the frame of reference of $G$ should be added. The new velocity is then $\mathbf{v_A}=\Omega \mathbf{r_A} \hat{e_{\theta}}$ with $\Omega$ the angular velocity of the Earth-Moon system, with the polar coordinates $(r,\theta)$. By projecting onto cartesian coordinates we get the initial velocity of Apollo in the frame of reference of $G$: $\mathbf{v_A}=\begin{pmatrix} \num{-1178.5} \\ \num{-597.6} \end{pmatrix}$.

\subsection{Minimal height without atmosphere}
In this new system we vary the direction of the initial velocity of Apollo so that it reaches a minimal Earth orbit height close to $h_{min} = 10000$ m with a precision better than $100$ m (Fig.\ref{fig:5a}). The effect of the atmosphere is neglected ($\rho_0 = 0$) and the precision is $\epsilon = \num{d-4}$.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.47\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex5a_hmin.eps}
    \caption{Difference between the minimal height of the orbit of Apollo around Earth and the desired minimal height $h_{min}$ with respect to the angle variation from the initial velocity direction}
    \label{fig:5a_hmin}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.5\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex5a_trajzoom.eps}
    \caption{Trajectories of Apollo for these angles. The inner blue circle is the final position of Earth and the blue line inside of it is its trajectory}
    \label{fig:5a_traj}
  \end{subfigure}
  \caption{Study of the minimal height of Apollo with respect to the angle of the initial velocity}
  \label{fig:5a}
\end{figure}

By proceeding empirically we find that with an angle variation of $-0.309676$ rad, Apollo reaches a minimal height of $1001.315$ m, which is a very good precision.

\subsection{Maximal acceleration with atmosphere}
With the same method, and with $\rho_0 = 1.2 ~\si{\kg \per \m^3}$, the maximal acceleration of Apollo is minimized like in section \ref{sec:minaccel} so that it lands on Earth with one atmosphere entry (Fig.\ref{fig:5b}).

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.47\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex5b_accel.eps}
    \caption{Maximal acceleration of Apollo with respect to the angle variation from the initial velocity direction. The blue line is the surface of the Earth}
    \label{fig:5b_amax}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.5\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex5b_traj.eps}
    \caption{Trajectories of Apollo for these angles}
    \label{fig:5b_traj}
  \end{subfigure}
  \caption{Study of the maximal acceleration of Apollo with respect to the angle of the initial velocity}
  \label{fig:5b}
\end{figure}

Apollo reaches a maximal acceleration of $6.45$ g at an angle variation of $-0.309176$ rad.

\section{Three bodies: Earth, Moon and a third body - Lagrangian points}
The goal of this section is to study the Lagrangian point L4, which location forms an equilateral triangle with the Earth and the Moon.

By using simple geometry, it is possible to find the exact position of L4. The initial velocity required to stay on this point with respect the the frame of reference $R'$ is given by $\mathbf{v} = \Omega \mathbf{r} \hat{e}_\theta$, with $\Omega$ the angular velocity of the Earth-Moon system.
These initial positions and the velocities of L4 with respect to $R'$ are given by equation \eqref{eq:L4_position_vitesse}.

\begin{equation}
  \mathbf{r_\text{L4}} =
  \begin{pmatrix}
    \num{187697755.46} \\
    \num{333201542.06}
  \end{pmatrix}
  \text{\si{\m} and }
  \mathbf{v_\text{L4}} =
  \begin{pmatrix}
    \num{886.85} \\
    \num{-499.58}
  \end{pmatrix}\si{\m\per\s}
  \label{eq:L4_position_vitesse}
\end{equation}

To study the stability of L4, a third body with a negligible mass is set on this point with the right initial conditions.
Figure \ref{fig:6a_traj} shows the trajectory of the probe when starting on this point, and figure \ref{fig:6a_dist} represents the evolution of the distance between the probe and both the Earth and the Moon.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex6a_traj.eps}
    \caption{Trajectory of Apollo 13 (in magenta), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:6a_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex6a_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:6a_dist}
  \end{subfigure}
  \caption{Stability analysis of L4. The simulation ran for a year, for \num{10423} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:6a_stab}
\end{figure}

The only information that can be extracted from figure \ref{fig:6a_traj} is that the trajectory of the probe is so condensed around a point, that it cannot be seen at this distance.
On the other hand, figure \ref{fig:6a_dist} does not seem to show constant distances.
However, both distances changes of order \SI{1000}{\m}, which is small compared to the distances considered (millions of meters).
Thus, this point seems to be stationary, as expected, but the informations from figure \ref{fig:6a_stab} are not enough to study the stability of this Lagrangian point.\\

To a study of the stability of this point, the probe will be placed \SI{1000}{\km} away from L4.
Figure \ref{fig:6b_traj} gives the trajectory of the probe and \ref{fig:6b_dist} the evolution of the distance between the probe and both the Moon and the Earth.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex6b_traj.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:6b_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex6b_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:6b_dist}
  \end{subfigure}
  \caption{Stability analysis of L4, with a gap of \SI{10000}{\km}. The simulation ran for a year, for \num{10505} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:6b_stab}
\end{figure}

Figure \ref{fig:6b_traj} shows that, even when the probe is away from L4, it will still stay in the region.
This confirms the expectation: L4 is a stable Lagrangian point.
If it were not the case, the probe would turn around the Earth of the Moon, but not around L4.
Figure \ref{fig:6b_traj} shows that the probe does not approach too much the Earth and the Moon, but rather stays around L4 as suggested by figure \ref{fig:6b_traj}.





\section{Optional}
%TODO: On parle de Coriolis et des forces d'inertie dans cette section ?
\subsection{The remaining Lagrangian points}
The section studies the remaining Lagrangian points, which are L1, L2, L3 and L5.

For a 3-body simulation with one negligible mass, equation \eqref{eq:5b_lagrange_general} gives the general evolution of the third body.
This equation comes from the lessons.

\begin{equation}
  \frac{d^2}{dt^2}
  \begin{pmatrix}
    x' \\
    y'
  \end{pmatrix}
  = -\Omega^2
  \begin{pmatrix}
    \frac{d^3\beta(x' + d\alpha)}{r'^3_{13}} + \frac{d^3\alpha(x' - d\beta)}{r'^3_{23}} - x'\\
    \frac{d^3\beta}{r'^3_{13}}y' + \frac{d^3\alpha}{r'^3_{23}}y' - y'
  \end{pmatrix}
  + 2\Omega\frac{d}{dt}
  \begin{pmatrix}
    y' \\
    -x'
  \end{pmatrix}
  \label{eq:5b_lagrange_general}
\end{equation}

with $\Omega$ the angular momentum of both the Earth (body 1) and the Moon (body 2) in the frame of reference $R'$, $r_{ij}$ the distance between bodies $i$ and $j$, $d$ the distance between the Earth and the Moon, $x'$ ($y'$) the horizontal (vertical) position of the third body, in the frame of reference $R'$, $\alpha = m_2/(m_1 + m_2)$, $\beta = m_1/(m_1 + m_2)$ and $m_i$ the mass of body $i$.\\

In this section, only stationary situations are considered, which means that all derivative are null.
Thus, the equation that will be used is given by equation \eqref{eq:5b_lagrange_stationnaire}.

\begin{equation}
  0
  =
  \begin{pmatrix}
    \frac{d^3\beta(x' + d\alpha)}{r'^3_{13}} + \frac{d^3\alpha(x' - d\beta)}{r'^3_{23}} - x'\\
    \frac{d^3\beta}{r'^3_{13}}y' + \frac{d^3\alpha}{r'^3_{23}}y' - y'
  \end{pmatrix}
  \label{eq:5b_lagrange_stationnaire}
\end{equation}

\subsubsection{Finding L1, L2 and L3}
Points L1, L2 and L3 are particular, because they are all located on the horizontal line, which implies that $y'=0$.
Thus, for equation \eqref{eq:5b_lagrange_stationnaire}, $r_{ij} = (x'_j - x'_i)\text{sgn}\left(x'_j - x_i\right)$.
To simplify the notation, define $\sigma_i = \text{sgn}\left(x'_j - x'_i\right)$.
The final equation for these point is then given by equation \eqref{eq:5b_lagrange_stationnaire_L123}.

\begin{equation}
  \frac{d^3\beta\left(x' + d\alpha\right)}{\left(x-x_1\right)^3\sigma_1} + \frac{d^3\alpha\left(x' - d\beta\right)}{\left(x-x_2\right)^3\sigma_2} - x' = 0
  \label{eq:5b_lagrange_stationnaire_L123}
\end{equation}

Each of these lagrangian points is determined by $\sigma_i$, at it explains where the third body is with respect to the two others.
Thus:
\begin{itemize}
  \item for L1: $\sigma_1$ = 1, $\sigma_2$ = -1;
  \item for L2: $\sigma_1$ = 1, $\sigma_2$ = 1;
  \item for L3: $\sigma_1$ = -1, $\sigma_2$ = -1.
\end{itemize}

Equation \eqref{eq:5b_lagrange_stationnaire_L123} needs to be solved numerically, as the final polynome is of 7th degree.
Thus, the position of point L1, L2 and L3 are given by:
\begin{itemize}
  \item for L1: $lx_1 = \SI{3.219948720257e8}{\m}$, $ly_1 = \SI{0}{\m}$
  \item for L2: $lx_2 = \SI{4.446515204924e8}{\m}$, $ly_2 = \SI{0}{\m}$
  \item for L3: $lx_3 = \SI{-3.866963974114e8}{\m}$, $ly_3 = \SI{0}{\m}$
\end{itemize}

\subsubsection{Finding L5}
Finding L5 is fairly easy, knowing the position of L4.
This point is a reflection of L4 with respect to the horizontal axis.
Thus, L5 is given by the initial position and velocity \ref{eq:pos_vit_L5}.

\begin{equation}
  \mathbf{r_\text{L5}} =
  \begin{pmatrix}
    \num{187697755.46} \\
    \num{-333201542.06}
  \end{pmatrix}
  \si{\m}
  \text{ and }
  \mathbf{v_\text{L5}} =
  \begin{pmatrix}
    \num{-886.85} \\
    \num{-499.58}
  \end{pmatrix}
  \si{\m\per\s}
  \label{eq:pos_vit_L5}
\end{equation}

\subsubsection{Stability of all points}
The stability of L1 is analysed by figures \ref{fig:7b_L1_traj} and \ref{fig:7b_L1_dist}.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L1_traj.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:7b_L1_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L1_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:7b_L1_dist}
  \end{subfigure}
  \caption{Stability analysis of L1. The simulation ran for a year, for \num{19932} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:7b_L1}
\end{figure}

L1 is a clear case of unstable point.
As shown by figure \ref{fig:7b_L1_traj}, the probe initialy started in L1, but it did not stay for long, as it immediately goes away.
At the beginning, the probe does not goes straight down, which is caused by Coriolis effect.
Futhermore, it starts orbiting around the Earth, instead of point L1.
Figure \ref{fig:7b_L1_dist} shows the evolution of the distances between the probe and the two other bodies.
This evolution has nothing to do with what L4 showed, as the variation is of order \SI{d8}{\m}.
The expectations are then confirmed by figure \ref{fig:7b_L1}: L1 is an unstable Lagrangian point.\\

The stability of L2 is analysed by figures \ref{fig:7b_L2_traj} and \ref{fig:7b_L2_dist}.
The same analysis as L1 can be performed for this point, and the conclusion is: L2 is an unstable Lagrangian point.\\

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L2_traj.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:7b_L2_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L2_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:7b_L2_dist}
  \end{subfigure}
  \caption{Stability analysis of L2. The simulation ran for a year, for \num{22834} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:7b_L2}
\end{figure}

The stability of L3 is analysed by figures \ref{fig:7b_L3_traj} and \ref{fig:7b_L3_dist}.
The stability of L3 is a bit different than L1 and L2.
The divergence of the probe is much slower to diverge, and one year is not enough to get interesting data.
Thus, the simulations were ran for two years instead on one.

Again, the probe does not stay around L3, and the same analysis as L1 and L2 can be done.
Thus, the expectations are correct: L3 is an unstable Lagrangian point.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L3_traj.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:7b_L3_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L3_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:7b_L3_dist}
  \end{subfigure}
  \caption{Stability analysis of L3. The simulation ran for two year, for \num{23247} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:7b_L3}
\end{figure}

The stability of L5 is analysed by figures \ref{fig:7b_L5_traj}, \ref{fig:7b_L5_dist}, \ref{fig:7b_L5_gap_traj} and \ref{fig:7b_L5_gap_dist}.
The same analysis as L4 can be done, and the conclusion is: L5 is a stable Lagrangian point.

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L5_stab_close.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius. The graph has been zoomed in several times to get informations.}
    \label{fig:7b_L5_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L5_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:7b_L5_dist}
  \end{subfigure}

  \caption{Stability analysis of L5. The simulation ran for a year, for \num{10647} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:7b_L5}
\end{figure}

\begin{figure}[h]
  \centering
  \begin{subfigure}[t]{0.55\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L5_gap_traj.png}
    \caption{Trajectory of Apollo 13 (range of colors represented by the speed of the probe), with the Earth (in blue) and the Moon (in red) at their right radius.}
    \label{fig:7b_L5_gap_traj}
  \end{subfigure}
  ~
  \begin{subfigure}[t]{0.4\textwidth}
    \includegraphics[width=\textwidth]{graphs/ex7b_L5_gap_dist.eps}
    \caption{Evolution of the distance between the probe and both the Earth and the Moon.}
    \label{fig:7b_L5_gap_dist}
  \end{subfigure}

  \caption{Stability analysis of L5, with a gap of \SI{10000}{\km}. The simulation ran for a year, for \num{10744} steps, with an adaptative time step of precision $\epsilon = \SI{e-4}{\m}$.}
  \label{fig:7b_L5}
\end{figure}


\subsubsection{Representation of Lagrangian points}
To conclude this section, a representation of all the Lagrangian points is drawn in figure \ref{fig:7b_allLPoints}.


\section{Conclusion}
With the results explained before, the astronauts have come back to Earth safely, and further explorations have been carried out.
This report showed how to bring back the astronauts, and studied the Lagrangian points.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{graphs/ex7b_allLPoints.eps}
  \caption{Representation of all computed Lagrangian points. The origin is the center of gravity between the Earth and the Moon, the blue circle is the Earth (false radius) and the red circle is the Moon (false radius).}
  \label{fig:7b_allLPoints}
\end{figure}






\addcontentsline{toc}{section}{References}
\begin{thebibliography}{99}
  \bibitem{nasa:ask_the_crew} Wakata, K. (2002, April 7). Ask the Crew: STS-92. Retrieved December 14, 2018, from \url{https://spaceflight.nasa.gov/feedback/expert/answer/crew/sts-92/index.html}
  \bibitem{wiki:g-suit} Wikipedia contributors. (2018, December 4). G-suit. In Wikipedia, The Free Encyclopedia. Retrieved 20:59, December 14, 2018, from \url{https://en.wikipedia.org/w/index.php?title=G-suit&oldid=871987759}
\end{thebibliography}
%TODO: Checker l'ordre des références.


\end{document}
